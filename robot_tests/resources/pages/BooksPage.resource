*** Settings ***
Documentation     Page Object for Books UI - Main catalog page
...
...               This resource file contains all keywords related to the Books catalog page,
...               including navigation, search, filtering, and book card interactions.
...
...               Source: Generated by Claude Code following Page Object Model pattern

Library           Browser    timeout=10s    retry_assertions_for=1s
Library           String
Resource          ../common.resource


*** Variables ***
# Page URL
${BOOKS_PAGE_URL}        ${UI_URL}

# Page Elements - Main Structure
${PAGE_CONTAINER}        css=body
${MAIN_CONTENT}          css=main, .main-content, #content
${HEADER}                css=header, .header

# Search Elements
${SEARCH_INPUT}          id=search-input
${SEARCH_INPUT_ALT}      css=input[placeholder*="search" i]
${SEARCH_BUTTON}         id=search-btn
${SEARCH_BUTTON_ALT}     css=button#search-btn
${SEARCH_RESULTS}        css=.search-results, .results, .books-container

# Book Cards
${BOOK_CARD}             css=.book-card
${BOOK_CARD_ALT}         css=.book, .book-item, [data-testid*="book"]
${BOOK_TITLE}            css=.book-title, .title, h2, h3
${BOOK_AUTHOR}           css=.book-author, .author, .author-name
${BOOK_ISBN}             css=.book-isbn, .isbn
${BOOK_YEAR}             css=.book-year, .year, .publication-year

# Loading & Messages
${LOADING_SPINNER}       css=.loading, .spinner, [aria-busy="true"]
${NO_RESULTS_MESSAGE}    css=.no-results, .empty-state
${ERROR_MESSAGE}         css=.error, .error-message, .alert-error

# Pagination (if exists)
${PAGINATION}            css=.pagination, nav[aria-label="pagination"]
${NEXT_PAGE_BUTTON}      css=.pagination button:has-text("Next")
${PREV_PAGE_BUTTON}      css=.pagination button:has-text("Previous")


*** Keywords ***
# Navigation Keywords
Open Books Page
    [Documentation]    Navigate to Books catalog page
    ...                Opens page and waits for initial load

    New Page    ${BOOKS_PAGE_URL}
    Wait For Page To Load
    Verify Books Page Loaded

Navigate To Books Catalog
    [Documentation]    Alternative entry point for navigation
    ...                Useful when starting from another page

    Go To    ${BOOKS_PAGE_URL}
    Wait For Page To Load
    Verify Books Page Loaded

Verify Books Page Loaded
    [Documentation]    Confirm Books page loaded successfully
    ...                Checks for presence of main page elements

    Wait For Elements State    ${PAGE_CONTAINER}    visible    timeout=${MEDIUM_TIMEOUT}
    ${url}=    Get Url
    Should Contain    ${url}    ${BASE_URL}    msg=Not on Books page: ${url}

# Search Keywords
Search For Books
    [Documentation]    Perform search operation
    ...                Enters search term and submits search form
    [Arguments]    ${search_term}

    Enter Search Term    ${search_term}
    Submit Search
    Wait For Search Results

Enter Search Term
    [Documentation]    Fill search input field with search term
    [Arguments]    ${search_term}

    # Try primary selector
    TRY
        Wait For Element To Be Ready    ${SEARCH_INPUT}    timeout=${SHORT_TIMEOUT}
        Fill Text    ${SEARCH_INPUT}    ${search_term}
    EXCEPT
        # Try alternative selector
        Wait For Element To Be Ready    ${SEARCH_INPUT_ALT}    timeout=${SHORT_TIMEOUT}
        Fill Text    ${SEARCH_INPUT_ALT}    ${search_term}
    END

    Log    Entered search term: ${search_term}

Submit Search
    [Documentation]    Submit search form by clicking search button

    # Try primary button
    TRY
        Click    ${SEARCH_BUTTON}
    EXCEPT
        # Try alternative button selector
        Click    ${SEARCH_BUTTON_ALT}
    END

    Log    Search submitted

Wait For Search Results
    [Documentation]    Wait for search results to appear
    ...                Handles loading state and result display

    # Wait for loading to disappear (if present)
    TRY
        Wait For Elements State    ${LOADING_SPINNER}    hidden    timeout=${SHORT_TIMEOUT}
    EXCEPT
        Log    No loading spinner detected    level=DEBUG
    END

    # Wait for results container
    Wait For Elements State    ${SEARCH_RESULTS}    visible    timeout=${MEDIUM_TIMEOUT}

Clear Search
    [Documentation]    Clear search input field

    TRY
        Clear Text    ${SEARCH_INPUT}
    EXCEPT
        Clear Text    ${SEARCH_INPUT_ALT}
    END

# Book Cards Keywords
Get All Book Cards
    [Documentation]    Retrieve all book card elements on page
    ...                Returns: List of book card elements

    TRY
        ${cards}=    Get Elements    ${BOOK_CARD}
        RETURN    ${cards}
    EXCEPT
        ${cards}=    Get Elements    ${BOOK_CARD_ALT}
        RETURN    ${cards}
    END

Get Book Card Count
    [Documentation]    Count number of book cards displayed
    ...                Returns: Integer count of book cards

    ${count}=    Get Element Count    ${BOOK_CARD}

    # If primary selector returns 0, try alternative
    IF    ${count} == 0
        ${count}=    Get Element Count    ${BOOK_CARD_ALT}
    END

    Log    Found ${count} book cards
    RETURN    ${count}

Find Book Card By Title
    [Documentation]    Locate book card by book title
    ...                Returns: Element handle for matching book card
    [Arguments]    ${book_title}

    VAR    ${selector}    xpath=//div[contains(@class, 'book-card') or contains(@class, 'book-item')]//descendant::*[contains(text(), '${book_title}')]
    Wait For Elements State    ${selector}    visible    timeout=${MEDIUM_TIMEOUT}

    ${element}=    Get Element    ${selector}
    RETURN    ${element}

Get Book Title From Card
    [Documentation]    Extract book title from book card element
    ...                Returns: Book title as string
    [Arguments]    ${card_element}

    VAR    ${selector}    ${card_element} >> ${BOOK_TITLE}
    ${title}=       Get Text    ${selector}

    RETURN    ${title}

Get Book Author From Card
    [Documentation]    Extract author name from book card element
    ...                Returns: Author name as string
    [Arguments]    ${card_element}

    VAR    ${selector}    ${card_element} >> ${BOOK_AUTHOR}
    ${author}=      Get Text    ${selector}

    RETURN    ${author}

Get Book Details From Card
    [Documentation]    Extract all details from book card
    ...                Returns: Dictionary with title, author, and other details
    [Arguments]    ${card_element}

    ${title}=     Get Book Title From Card    ${card_element}
    ${author}=    Get Book Author From Card   ${card_element}

    VAR    &{details}    title=${title}    author=${author}

    RETURN    &{details}

Click Book Card
    [Documentation]    Click on book card to open details
    [Arguments]    ${card_element}

    Click    ${card_element}
    Wait For Load State    networkidle    timeout=${MEDIUM_TIMEOUT}

# Verification Keywords
Verify Book Card Contains Text
    [Documentation]    Verify book card contains expected text
    [Arguments]    ${card_element}    ${expected_text}

    ${card_text}=    Get Text    ${card_element}
    Should Contain    ${card_text}    ${expected_text}
    ...    msg=Book card does not contain: ${expected_text}

Verify Book Exists On Page
    [Documentation]    Confirm specific book is visible on page
    [Arguments]    ${book_title}

    VAR    ${selector}    xpath=//*[contains(text(), '${book_title}')]
    Wait For Elements State    ${selector}    visible    timeout=${MEDIUM_TIMEOUT}
    Log    Verified book exists: ${book_title}

Verify Minimum Book Count
    [Documentation]    Verify at least minimum number of books displayed
    [Arguments]    ${minimum_count}

    ${actual_count}=    Get Book Card Count
    Should Be True    ${actual_count} >= ${minimum_count}
    ...    msg=Expected at least ${minimum_count} books, but found ${actual_count}

Verify Exact Book Count
    [Documentation]    Verify exact number of books displayed
    [Arguments]    ${expected_count}

    ${actual_count}=    Get Book Card Count
    Should Be Equal As Integers    ${actual_count}    ${expected_count}
    ...    msg=Expected ${expected_count} books, but found ${actual_count}

Verify No Books Found Message
    [Documentation]    Verify "no results" message is displayed

    Wait For Elements State    ${NO_RESULTS_MESSAGE}    visible    timeout=${SHORT_TIMEOUT}
    Log    No results message displayed

Verify Books Page Is Responsive
    [Documentation]    Verify page loaded and is interactive

    Wait For Elements State    ${PAGE_CONTAINER}    visible    timeout=${SHORT_TIMEOUT}
    ${url}=    Get Url
    Should Contain    ${url}    ${BASE_URL}

# Utility Keywords
Get All Visible Book Titles
    [Documentation]    Extract all book titles currently visible
    ...                Returns: List of book titles

    @{cards}=     Get All Book Cards
    @{titles}=    Create List

    FOR    ${card}    IN    @{cards}
        ${title}=    Get Book Title From Card    ${card}
        Append To List    ${titles}    ${title}
    END

    ${count}=    Get Length    ${titles}
    Log    Found ${count} book titles
    RETURN    @{titles}

Verify Search Results Match Term
    [Documentation]    Verify search results contain search term
    ...                Checks titles or authors contain the search term
    [Arguments]    ${search_term}

    @{titles}=    Get All Visible Book Titles
    ${found}=     Set Variable    ${False}

    FOR    ${title}    IN    @{titles}
        ${title_lower}=    Convert To Lower Case    ${title}
        ${term_lower}=     Convert To Lower Case    ${search_term}

        IF    '${term_lower}' in '${title_lower}'
            ${found}=    Set Variable    ${True}
            BREAK
        END
    END

    Should Be True    ${found}
    ...    msg=No search results contain term: ${search_term}
